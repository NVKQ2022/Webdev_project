@model List<Webdev_project.Models.CartItem>
@{
    ViewData["Title"] = "Giỏ Hàng";
}
<!-- ...HTML layout... -->

@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    //Layout = null;
}



<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giỏ Hàng Shopee</title>
    <style>
        /* body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #ff5722;
            padding: 12px 40px;
        }

        .logo {
            height: 70px;
        }

        .nav-menu {
            display: flex;
            justify-content: space-between;
            flex: 1;
            margin: 0 20px;
        }

            .nav-menu ul {
                display: flex;
                list-style: none;
                gap: 15px;
                padding: 0;
                margin: 0;
            }

            .nav-menu a {
                color: white;
                text-decoration: none;
            }

        .user-info {
            color: white;
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 40px;
        }

        .title-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-text {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .title-logo h1 {
            font-size: 18px;
            color: #ff5722;
            margin: 0;
        }

        .small-logo {
            height: 50px;
        }

        .shopee-text {
            font-size: 18px;
            font-weight: bold;
            color: #ff5722;
        }

        .divider {
            font-size: 20px;
            color: #999999;
            padding: 0 10px;
        }

        .search-bar {
            display: flex;
            width: 50%;
            background-color: white;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }

            .search-bar input, .search-bar button {
                padding: 10px;
                border: none;
            }

            .search-bar input {
                flex: 1;
            }

            .search-bar button {
                background-color: #ff5722;
                color: white;
                cursor: pointer;
            } */

        .cart-table img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 0.375rem;
        }

        .cart-table td, .cart-table th {
            vertical-align: middle;
        }

        .btn-outline-secondary {
            min-width: 32px;
        }

        .quantity-input {
            max-width: 50px;
        }

        .btn-remove {
            font-size: 0.9rem;
        }

        .cart-summary {
            background-color: #f9f9f9;
            border-radius: 0.5rem;
            padding: 1rem 1.5rem;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body>
    <div>
        
        
    </div> <!--removed -->
    <!--sản phẩm trong  giỏ hàng-->
@* 
    <div class="container" style="max-width: 1100px;">
        <form>
            <table class="table align-middle mt-4">
                <thead class="table-light">
                    <tr>
                        <th scope="col"><input type="checkbox" /></th>
                        <th scope="col">Sản phẩm</th>
                        <th scope="col">Đơn giá</th>
                        <th scope="col">Số lượng</th>
                        <th scope="col">Thành tiền</th>
                        <th scope="col">Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td><input type="checkbox" /></td>
                            <td class="d-flex align-items-center">
                                <img src="@item.Image" alt="Product" style="width:60px; height:60px; object-fit:cover;" class="me-2 rounded">
                                <span>@item.ProductName</span>
                            </td>
                            <td class="text-danger">@item.UnitPrice.ToString("C0", System.Globalization.CultureInfo.GetCultureInfo("vi-VN"))</td>
                            <td>
                                <div class="input-group input-group-sm" style="width:120px;">
                                    <form asp-action="Decrease" method="post" class="d-inline">
                                        <input type="hidden" name="productId" value="@item.ProductId" />
                                        <button class="btn btn-outline-secondary" type="submit">-</button>
                                    </form>
                                    <input type="text" class="form-control text-center" value="@item.Quantity" readonly />
                                    <form asp-action="Increase" method="post" class="d-inline">
                                        <input type="hidden" name="productId" value="@item.ProductId" />
                                        <button class="btn btn-outline-secondary" type="submit">+</button>
                                    </form>
                                </div>
                            </td>
                            <td class="text-danger">@((item.UnitPrice * item.Quantity).ToString("C0", System.Globalization.CultureInfo.GetCultureInfo("vi-VN")))</td>
                            <td>
                                <!-- Xử lý nút xóa nếu muốn -->                     
                                <form asp-action="Remove" method="post" style="display:inline;">
                                    <input type="hidden" name="productId" value="@item.ProductId" />
                                    <button class="btn btn-link text-danger" type="submit">Xóa</button>
                                </form>
                            </td>

                        </tr>
                    }
                </tbody>


            </table>
            <div class="d-flex justify-content-end align-items-center mt-4">
                <span class="me-3 fw-bold">Tổng thanh toán (1 sản phẩm):</span>
                <span class="fs-4 text-danger fw-bold me-4">₫19.000</span>
                <button class="btn btn-danger btn-lg px-5">Mua hàng</button>
            </div>
        </form>
    </div> *@

   @*  @foreach (var item in Model)
    {
        <tr id="row-@item.ProductId">
            <td><input type="checkbox" /></td>
            <td class="d-flex align-items-center">
                <img src="@item.Image" alt="Product" style="width:60px; height:60px; object-fit:cover;" class="me-2 rounded">
                <span>@item.ProductName</span>
            </td>
            <td class="text-danger unit-price" data-price="@item.UnitPrice">
                @item.UnitPrice.ToString("C0", System.Globalization.CultureInfo.GetCultureInfo("vi-VN"))
            </td>
            <td>
                <div class="input-group input-group-sm" style="width:120px;">
                    <button class="btn btn-outline-secondary btn-decrease" type="button" data-product-id="@item.ProductId">-</button>
                    <input type="text" class="form-control text-center quantity-input" id="qty-@item.ProductId" value="@item.Quantity" readonly />
                    <button class="btn btn-outline-secondary btn-increase" type="button" data-product-id="@item.ProductId">+</button>
                </div>
            </td>
            <td class="text-danger total-price" id="total-@item.ProductId" data-value="@(item.UnitPrice * item.Quantity)">
                @((item.UnitPrice * item.Quantity).ToString("C0", System.Globalization.CultureInfo.GetCultureInfo("vi-VN")))
            </td>
            <td>
                <button class="btn btn-link text-danger btn-remove" type="button" data-product-id="@item.ProductId">Xóa</button>
            </td>
        </tr>
    } *@





    <table class="table table-bordered table-hover align-middle cart-table">
        <thead class="table-light">
            <tr>
                <th><input type="checkbox" /></th>
                <th>Sản phẩm</th>
                <th>Đơn giá</th>
                <th>Số lượng</th>
                <th>Thành tiền</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr id="row-@item.ProductId">
                    <td><input type="checkbox" /></td>
                    <td class="d-flex align-items-center">
                        <img src="@item.Image" alt="Product" class="me-2">
                        <span>@item.ProductName</span>
                    </td>
                    <td class="text-danger unit-price" data-price="@item.UnitPrice">
                        @item.UnitPrice.ToString("C0", System.Globalization.CultureInfo.GetCultureInfo("vi-VN"))
                    </td>
                    <td>
                        <div class="input-group input-group-sm" style="width:120px;">
                            <button class="btn btn-outline-secondary btn-decrease" type="button" data-product-id="@item.ProductId">-</button>
                            <input type="text" class="form-control text-center quantity-input" id="qty-@item.ProductId" value="@item.Quantity" readonly />
                            <button class="btn btn-outline-secondary btn-increase" type="button" data-product-id="@item.ProductId">+</button>
                        </div>
                    </td>
                    <td class="text-danger total-price" id="total-@item.ProductId" data-value="@(item.UnitPrice * item.Quantity)">
                        @((item.UnitPrice * item.Quantity).ToString("C0", System.Globalization.CultureInfo.GetCultureInfo("vi-VN")))
                    </td>
                    <td>
                        <button class="btn btn-link text-danger btn-remove" type="button" data-product-id="@item.ProductId">Xóa</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <div class="d-flex justify-content-end mt-4">
        <div class="cart-summary d-flex align-items-center gap-4">
            <span class="fw-bold">Tổng thanh toán:</span>
            <span id="cart-total" class="fs-4 text-danger fw-bold">
                @* @Model.Sum(i => i.UnitPrice * i.Quantity).ToString("C0", System.Globalization.CultureInfo.GetCultureInfo("vi-VN")) *@
                <span id="cart-total" class="fs-4 text-danger fw-bold d-none">₫0</span>

            </span>
            <button class="btn btn-danger btn-lg px-5">Mua hàng</button>
        </div>
    </div>




    















    


</body>
</html>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        

                function formatCurrency(number) {
            return number.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
        }

        function updateCartTotal() {
            // let total = 0;
            // $('input[type="checkbox"]:checked').each(function () {
            //     const $row = $(this).closest('tr');
            //     const value = parseFloat($row.find('.total-price').data('value'));
            //     if (!isNaN(value)) {
            //         total += value;
            //     }
            // });
            // $('#cart-total').text(formatCurrency(total));
                let total = 0;
                let checkedCount = 0;

                $('input[type="checkbox"]:checked').each(function () {
                    const $row = $(this).closest('tr');
                    const value = parseFloat($row.find('.total-price').data('value'));
                    if (!isNaN(value)) {
                        total += value;
                        checkedCount++;
                    }
                });

                const $cartTotal = $('#cart-total');

                if (checkedCount > 0) {
                    $cartTotal.text(formatCurrency(total)).removeClass('d-none');
                } else {
                    $cartTotal.text('₫0').addClass('d-none');
                }
        }

        $(document).ready(function () {
            // Checkbox change event
            $('input[type="checkbox"]').change(function () {
                updateCartTotal();
            });

            // Increase quantity
            $('.btn-increase').click(function () {
                const productId = $(this).data('product-id');
                $.post('/ShoppingCart/UpdateQuantity', { productId, delta: 1 }, function (newQuantity) {
                    if (newQuantity <= 0) return;
                    const $qtyInput = $('#qty-' + productId);
                    const unitPrice = parseFloat($('#row-' + productId + ' .unit-price').data('price'));

                    $qtyInput.val(newQuantity);

                    const total = unitPrice * newQuantity;
                    const $totalCell = $('#total-' + productId);
                    $totalCell.text(formatCurrency(total));
                    $totalCell.data('value', total);

                    updateCartTotal();
                });
            });

            // Decrease quantity
            $('.btn-decrease').click(function () {
                const productId = $(this).data('product-id');
                $.post('/ShoppingCart/UpdateQuantity', { productId, delta: -1 }, function (newQuantity) {
                    if (newQuantity <= 0) return;
                    const $qtyInput = $('#qty-' + productId);
                    const unitPrice = parseFloat($('#row-' + productId + ' .unit-price').data('price'));

                    $qtyInput.val(newQuantity);

                    const total = unitPrice * newQuantity;
                    const $totalCell = $('#total-' + productId);
                    $totalCell.text(formatCurrency(total));
                    $totalCell.data('value', total);

                    updateCartTotal();
                });
            });

            // Remove item
            $('.btn-remove').click(function () {
                const productId = $(this).data('product-id');
                $.post('/ShoppingCart/RemoveItem', { productId }, function () {
                    $('#row-' + productId).remove();
                    updateCartTotal();
                });
            });
        });

    </script>
}
