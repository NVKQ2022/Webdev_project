@{
    ViewData["Title"] = "Home Page";
    // Layout = null;
    var isLoggedIn = ViewBag.isLoggedIn;
    List<Category> Categories = ViewBag.Categories;
    // List<string> categories = ViewBag.Categories;
    // var categoryNumber= Categories.Count;

    List<Product_zip> product_Zips = ViewBag.product; 
}

<style>
    #categoryItems .card {
        width: 180px;
        min-width: 180px;
        margin-right: 16px;
        border-radius: 0.5rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
        background-color: #fff;
        border: 1px solid #e2e8f0;
        height: 260px; /* 🔼 Increased height */
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    #categoryItems .card-img-top {
        height: 160px; /* 🔼 Increased image height */
        object-fit: cover;
        border-top-left-radius: 0.5rem;
        border-top-right-radius: 0.5rem;
        width: 100%;
    }
    

</style>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<!-- Font Awesome -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
	



    
    @* <h3> THE BEST SO FAR</h3>
    <h5 class="fw-bold mb-3">DANH MỤC</h5>

    <div class="position-relative"
         style="max-width: calc(6 * (180px + 16px)); margin: auto; overflow: hidden;">

        <button class="btn btn-light position-absolute start-0"
                style="top: 30%; transform: translateY(-50%) translateX(-80%); z-index: 2;"
                onclick="scrollCategory(-1)">
            <i class="bi bi-chevron-left fs-4"></i>
        </button>

        <div id="categoryCarousel" class="d-flex overflow-hidden" style="scroll-behavior: smooth; width: 100%;">
            <div id="categoryItems" class="d-flex">
                @foreach (var category in Categories)
                {
                    <div class="card shadow-sm border-0" role="button" tabindex="0" aria-label="@category.CateName">
                        <img src="@category.Image" class="card-img-top" alt="@category.CateName" />
                        <div class="card-body p-2">
                            <h6 class="card-title text-truncate">@category.CateName</h6>
                            <p class="mb-1 small text-muted">Đã mua: <span class="text-dark">@category.BuyTime</span></p>
                            <p class="mb-0 small text-muted">Sản phẩm: <span class="text-dark">@category.ProductQuantity</span></p>
                        </div>
                    </div>
                }
            </div>
        </div>

        <button class="btn btn-light position-absolute end-0"
                style="top: 30%; transform: translateY(-50%) translateX(80%); z-index: 2;"
                onclick="scrollCategory(1)">
            <i class="bi bi-chevron-right fs-4"></i>
        </button>
    </div>
 *@


    <h5 class="fw-bold mb-3">DANH MỤC</h5>

    <!-- 📦 Enlarged container: made wider and added padding -->
    <div class="position-relative"
         style="max-width: calc(6 * (180px + 16px) + 58px); margin: auto; overflow: hidden; padding: 0 40px;">

        <!-- ⬅ Left Arrow -->
        <button class="btn btn-light position-absolute start-0"
                style="top: 30%; transform: translateY(-50%); z-index: 3;"
                onclick="scrollCategory(-1)">
            <i class="bi bi-chevron-left fs-4"></i>
        </button>

        <!-- 🎠 Scrollable category list -->
        <div id="categoryCarousel" class="d-flex overflow-hidden" style="scroll-behavior: smooth; width: 100%;">
            <div id="categoryItems" class="d-flex">
                @foreach (var category in Categories)
                {
                <div class="card shadow-sm border-0" role="button" tabindex="0" aria-label="@category.CateName" onclick="loadProducts('@category.CateName')" >
                        <img src="@category.Image" class="card-img-top" alt="@category.CateName" />
                        <div class="card-body p-2">
                            <h6 class="card-title text-truncate">@category.CateName</h6>
                            <p class="mb-1 small text-muted">Đã mua: <span class="text-dark">@category.BuyTime</span></p>
                            <p class="mb-0 small text-muted">Sản phẩm: <span class="text-dark">@category.ProductQuantity</span></p>
                        </div>
                </div>
                }
            </div>
        </div>

        <!-- ➡ Right Arrow -->
        <button class="btn btn-light position-absolute end-0"
                style="top: 30%; transform: translateY(-50%); z-index: 3;"
                onclick="scrollCategory(1)">
            <i class="bi bi-chevron-right fs-4"></i>
        </button>
    </div>




@model List<Product_zip>



<div class="container my-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="fw-bold">GỢI Ý HÔM NAY</h5>
        <a href="#" class="text-decoration-none text-danger fw-semibold">Xem tất cả &gt;</a>
    </div>

    <<div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-6 g-3">
        @if (product_Zips != null)
        {
            foreach (var item in product_Zips)
            {
                <div class="col">
                    <!-- Wrap the entire card inside an anchor tag -->
                    <a href="/Product/Detail/@item.Product_zipId" class="text-decoration-none">
                        <div class="card h-100 position-relative border">
                            <img src="@item.Image" class="card-img-top" style="height: 180px; object-fit: cover;" />
                            <div class="card-body p-2">
                                <span class="badge bg-danger mb-1 text-white">Yêu thích</span>
                                <h6 class="card-title text-truncate" title="@item.Name">@item.Name</h6>
                                <p class="text-muted small mb-1">Đã bán @item.QuantitySold</p>

                                <!-- Rating Section -->
                                <div class="d-flex align-items-center mb-1">
                                    <div class="star-rating">
                                        @for (var i = 0; i < 5; i++)
                                        {
                                            if (i < Math.Floor(item.Rating))
                                            {
                                                <i class="bi bi-star-fill text-warning"></i> <!-- Filled Star -->
                                            }
                                            else if (i < Math.Floor(item.Rating) + 0.5 && item.Rating % 1 != 0)
                                            {
                                                <i class="bi bi-star-half text-warning"></i> <!-- Half Star -->
                                            }
                                            else
                                            {
                                                <i class="bi bi-star text-muted"></i> <!-- Empty Star -->
                                            }
                                        }
                                    </div>

                                    <span class="ms-2 text-muted small">(@item.Rating)</span>
                                </div>

                                <div class="text-danger fw-bold">₫@item.Price.ToString("N0")</div>
                            </div>
                        </div>
                    </a>
                </div>
            }
        }
    </div>





</div>




<!-- Bootstrap Icons CDN -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<script>

                   const container = document.getElementById('categoryCarousel');
               const itemsContainer = document.getElementById('categoryItems');

               // Calculate the width of one card + margin-right
               const card = itemsContainer.querySelector('.card');
               const style = window.getComputedStyle(card);
               const cardWidth = card.offsetWidth + parseInt(style.marginRight);

               let currentScrollPosition = 0;

               function scrollCategory(direction) {
                   const visibleWidth = container.clientWidth;
                   const maxScrollLeft = itemsContainer.scrollWidth - visibleWidth;

                   // Scroll exactly 6 cards width at a time
                   const scrollStep = cardWidth * 6;

                   currentScrollPosition += direction * scrollStep;

                   if (currentScrollPosition < 0) currentScrollPosition = 0;
                   if (currentScrollPosition > maxScrollLeft) currentScrollPosition = maxScrollLeft;

                   container.scrollTo({
                       left: currentScrollPosition,
                       behavior: 'smooth'
                   });
               }

               window.addEventListener('resize', () => {
                   currentScrollPosition = 0;
                   container.scrollTo({ left: 0, behavior: 'smooth' });
               });







    function redirectToProductDetail(productZipId) {
        window.location.href = '/Product/Detail/' + productZipId;
    }

      function loadProducts(cateName) {
            fetch(`/Category/ProductsByCategory?categoryId=${cateName}`)
                .then(response => response.text())
                .then(html => {
                    document.getElementById('productContainer').innerHTML = html;
                })
                .catch(err => {
                    console.error(err);
                    document.getElementById('productContainer').innerHTML = `<p class="text-danger">Không thể tải sản phẩm.</p>`;
                });
        }

</script>













